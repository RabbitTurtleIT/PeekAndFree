<!DOCTYPE html>
<html lang="kr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,user-scalable=no">
  <title>í”¼í¬ì•¤í”„ë¦¬ - ì¥ì†Œ ìƒì„¸</title>
  <!-- Google ì• ë“œì„¼ìŠ¤ -->
   <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6014668630461832"
     crossorigin="anonymous"></script>
  <!-- update the version number as needed -->
  <script defer src="/__/firebase/11.7.1/firebase-app-compat.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/11.7.1/firebase-auth-compat.js"></script>
  <script defer src="/__/firebase/11.7.1/firebase-database-compat.js"></script>
  <script defer src="/__/firebase/11.7.1/firebase-firestore-compat.js"></script>
  <script defer src="/__/firebase/11.7.1/firebase-functions-compat.js"></script>
  <script defer src="/__/firebase/11.7.1/firebase-messaging-compat.js"></script>
  <script defer src="/__/firebase/11.7.1/firebase-storage-compat.js"></script>
  <script defer src="/__/firebase/11.7.1/firebase-analytics-compat.js"></script>
  <script defer src="/__/firebase/11.7.1/firebase-remote-config-compat.js"></script>
  <script defer src="/__/firebase/11.7.1/firebase-performance-compat.js"></script>
  <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
<script src="js/index.js"></script>
<link href="css/index.css" rel="stylesheet">
  
  <!-- BOOTSTRAP -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
  <!-- <link href="css/bootstrap.css" rel="stylesheet"> -->
   <link href="css/index.css" rel="stylesheet">
  <script src="js/jquery-3.7.1.min"></script>

  <script defer src="/__/firebase/init.js?useEmulator=true"></script>

</head>

<body>
  
<!-- Nav tabs -->
<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">ê¸°ë³¸ ì •ë³´</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">ì¶•ì œ ë° í–‰ì‚¬</button>
  </li>
</ul>

<!-- Tab panes -->
<div class="tab-content">
  <div class="tab-pane active" id="home" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
    <div class="p-5">
        <div class="modal-title">
            <h5 id="name">ì¼ë³¸ ë„ì¿„ğŸ‡¯ğŸ‡µ</h5>
            <h6>ì „í†µ ì‚¬ì›ê³¼ í˜„ëŒ€ì ì¸ ë§ˆì²œë£¨ê°€ ê³µì¡´í•˜ë©°, ê³¨ëª©ë§ˆë‹¤ íŠ¹ìƒ‰ ìˆëŠ” ìŒì‹ì ê³¼ ìƒì ë“¤ì´ ìë¦¬í•œ, ê³¼ê±°ì™€ í˜„ì¬ê°€ ì¡°í™”ë¡­ê²Œ ì–´ìš°ëŸ¬ì§„ ë„ì‹œ.</h6>
        </div>
        <div class="mt-3 d-flex modal-body" id="imgDiv" style="width: 100%; overflow-y: scroll;">
        </div>
        <div class="mt-3 modal-body">
            <p>ğŸ’µ <span id="exchangerate">í™˜ìœ¨ ì •ë³´ë¥¼ ì œê³µí•˜ì§€ ì•ŠëŠ” êµ­ê°€</span></p>
        </div>
        <div class="mt-3 modal-body" id="weather-forecast-section">
            <div id="weather-forecast-container">
                <!-- ë‚ ì”¨ ì •ë³´ê°€ ë™ì ìœ¼ë¡œ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤. -->
            </div>
        </div>
        <style>
            #weather-forecast-container {
                display: flex;
                overflow-x: auto;
                padding: 10px 5px;
                gap: 10px;
                scrollbar-width: none; /* Firefox */
            }
            #weather-forecast-container::-webkit-scrollbar {
                display: none; /* Safari and Chrome */
            }
            .weather-day-card {
                flex: 0 0 auto;
                width: 50px;
                padding: 10px;
                border-radius: 20px;
                background-color: #FEF7E0;
                text-align: center;
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
                color: #333;
                display: flex;
                flex-direction: column;
                justify-content: space-around;
            }
            .weather-day-date {
                font-size: 1rem;
                font-weight: 600;
            }
            .weather-day-icon {
                font-size: 2rem; /* ì´ëª¨ì§€ í¬ê¸° */
                line-height: 1.2;
                margin: 4px 0;
            }
            .weather-day-temp {
                font-size: 1.1rem;
                font-weight: 600;
            }
        </style>
        <button class="btn btn-warning">í•­ê³µê¶Œ ì˜ˆë§¤í•˜ê¸°</button>
    </div>
  </div>
  <div class="tab-pane" id="profile" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
    <div class="container calendar-container">
        <div class="month-navigation">
          <button class="nav-btn" onclick="changeMonth(-1)">â€¹</button>
          <div class="w-100 d-flex justify-content-around">
            <div class="month-title" id="monthTitle1">2025ë…„ 7ì›”</div>
            <div class="month-title" id="monthTitle2">2025ë…„ 8ì›”</div>
          </div>
          <button class="nav-btn" onclick="changeMonth(1)">â€º</button>
        </div>
        
        <div class="row">
          <div class="col-md-6">
            <div class="calendar-grid" id="calendar1"></div>
          </div>
          <div class="col-md-6">
            <div class="calendar-grid" id="calendar2"></div>
          </div>
        </div>
      </div>
  </div>
</div>
    

  <script>
    async function loadImg(coord1, coord2) {
        const getImagesFn = firebase.functions().httpsCallable('getPlaceImages');
        try {
            const cachedResult = await getImagesFn({ lat: coord1, lon: coord2 });

            if (cachedResult.data && cachedResult.data.length > 0) {
                console.log("ì´ë¯¸ì§€ ìºì‹œ ë°œê²¬! DBì—ì„œ ë¡œë“œí•©ë‹ˆë‹¤.");
                $("#imgDiv").empty();
                cachedResult.data.forEach(url => {
                    const img = $(`<img class="rounded m-1" style="object-fit:cover; max-height: 200px; max-width: 200px;" src="${url}"/>`);
                    $("#imgDiv").append(img);
                });
            } else {
                console.log("ì´ë¯¸ì§€ ìºì‹œ ì—†ìŒ. Google Places APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.");
                const { Place, SearchNearbyRankPreference } = await google.maps.importLibrary("places");
                let center = new google.maps.LatLng(coord1, coord2);
                const request = {
                    fields: ["displayName", "photos"],
                    locationRestriction: {
                        center: center,
                        radius: 30000,
                    },
                    includedPrimaryTypes: ["cultural_landmark", "historical_landmark", "beach", "hiking_area"],
                    maxResultCount: 10,
                    rankPreference: SearchNearbyRankPreference.POPULARITY,
                    language: "ko-kr",
                };

                const { places } = await Place.searchNearby(request);

                if (places.length) {
                    const imageUrls = places.map(place => place.photos[0].getURI());

                    // Display images
                    $("#imgDiv").empty();
                    imageUrls.forEach(url => {
                        const img = $(`<img class="rounded m-1" style="object-fit:cover; max-height: 200px; max-width: 200px;" src="${url}"/>`);
                        $("#imgDiv").append(img);
                    });

                    // Store images in cache for next time
                    const storeImagesFn = firebase.functions().httpsCallable('storePlaceImages');
                    await storeImagesFn({ lat: coord1, lon: coord2, urls: imageUrls });
                    console.log("ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¥¼ ìºì‹œì— ì €ì¥í–ˆìŠµë‹ˆë‹¤.");

                } else {
                    $("#imgDiv").text("ì£¼ë³€ì˜ ì¶”ì²œ ì¥ì†Œ ì´ë¯¸ì§€ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                }
            }
        } catch (error) {
            console.error("ì´ë¯¸ì§€ ë¡œë”© ì¤‘ ì—ëŸ¬ ë°œìƒ:", error);
            $("#imgDiv").text("ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    }
        
    document.addEventListener('DOMContentLoaded', function () {

        let query = window.location.search;
        let param = new URLSearchParams(query);
        let coord2 = param.get('coord1');
        let coord1 = param.get('coord2');
        let cityname = param.get('Cityname');
        let nationname = param.get('Nationname');
        $("#name").text(nationname + " " + cityname)
      //êµ¬ê¸€ë§µ
      firebase.functions().httpsCallable('getGoogleMapAPIKey')().then((result) => {
        (g => { var h, a, k, p = "The Google Maps JavaScript API", c = "google", l = "importLibrary", q = "__ib__", m = document, b = window; b = b[c] || (b[c] = {}); var d = b.maps || (b.maps = {}), r = new Set, e = new URLSearchParams, u = () => h || (h = new Promise(async (f, n) => { await (a = m.createElement("script")); e.set("libraries", [...r] + ""); for (k in g) e.set(k.replace(/[A-Z]/g, t => "_" + t[0].toLowerCase()), g[k]); e.set("callback", c + ".maps." + q); a.src = `https://maps.${c}apis.com/maps/api/js?` + e; d[q] = f; a.onerror = () => h = n(Error(p + " could not load.")); a.nonce = m.querySelector("script[nonce]")?.nonce || ""; m.head.append(a) })); d[l] ? console.warn(p + " only loads once. Ignoring:", g) : d[l] = (f, ...n) => r.add(f) && u().then(() => d[l](f, ...n)) })({
          key: result.data,
          v: "weekly",
          // Use the 'v' parameter to indicate the version to use (weekly, beta, alpha, etc.).
          // Add other bootstrap parameters as needed, using camel case.
        });
        console.log("Google map ready")
        loadImg(Number(coord1), Number(coord2))
      }).catch((error) => {
        console.log("ERROR!", error);
      });

      function weatherTypeToEmoji(type) {
        const mapping = {
            'CLEAR': 'â˜€ï¸',
            'MOSTLY_CLEAR': 'ğŸŒ¤ï¸',
            'PARTLY_CLOUDY': 'â›…ï¸',
            'MOSTLY_CLOUDY': 'ğŸŒ¥ï¸',
            'CLOUDY': 'â˜ï¸',
            'WINDY': 'ğŸŒ¬ï¸',
            'WIND_AND_RAIN': 'ğŸŒ§ï¸',
            'LIGHT_RAIN_SHOWERS': 'ğŸŒ¦ï¸',
            'CHANCE_OF_SHOWERS': 'ğŸŒ¦ï¸',
            'SCATTERED_SHOWERS': 'ğŸŒ¦ï¸',
            'RAIN_SHOWERS': 'ğŸŒ¦ï¸',
            'HEAVY_RAIN_SHOWERS': 'ğŸŒ§ï¸',
            'LIGHT_TO_MODERATE_RAIN': 'ğŸŒ§ï¸',
            'MODERATE_TO_HEAVY_RAIN': 'ğŸŒ§ï¸',
            'RAIN': 'ğŸŒ§ï¸',
            'LIGHT_RAIN': 'ğŸŒ¦ï¸',
            'HEAVY_RAIN': 'ğŸŒ§ï¸',
            'RAIN_PERIODICALLY_HEAVY': 'ğŸŒ§ï¸',
            'LIGHT_SNOW_SHOWERS': 'ğŸŒ¨ï¸',
            'CHANCE_OF_SNOW_SHOWERS': 'ğŸŒ¨ï¸',
            'SCATTERED_SNOW_SHOWERS': 'ğŸŒ¨ï¸',
            'SNOW_SHOWERS': 'ğŸŒ¨ï¸',
            'HEAVY_SNOW_SHOWERS': 'â„ï¸',
            'LIGHT_TO_MODERATE_SNOW': 'ğŸŒ¨ï¸',
            'MODERATE_TO_HEAVY_SNOW': 'â„ï¸',
            'SNOW': 'â„ï¸',
            'LIGHT_SNOW': 'ğŸŒ¨ï¸',
            'HEAVY_SNOW': 'â„ï¸',
            'SNOWSTORM': 'â„ï¸',
            'SNOW_PERIODICALLY_HEAVY': 'â„ï¸',
            'HEAVY_SNOW_STORM': 'â„ï¸',
            'BLOWING_SNOW': 'ğŸŒ¬ï¸â„ï¸',
            'RAIN_AND_SNOW': 'ğŸŒ¨ï¸',
            'HAIL': 'ğŸŒ¨ï¸',
            'HAIL_SHOWERS': 'ğŸŒ¨ï¸',
            'THUNDERSTORM': 'â›ˆï¸',
            'THUNDERSHOWER': 'â›ˆï¸',
            'LIGHT_THUNDERSTORM_RAIN': 'â›ˆï¸',
            'SCATTERED_THUNDERSTORMS': 'â›ˆï¸',
            'HEAVY_THUNDERSTORM': 'â›ˆï¸',
            'FOG': 'ğŸŒ«ï¸',
            'HAZE': 'ğŸŒ«ï¸',
            'DUST': 'ğŸ’¨'
        };
        return mapping[type] || 'â“';
      }

      console.log("ë‚ ì”¨ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.")
      firebase.functions().httpsCallable('getWeatherForecast')({
        lat: Number(coord1),
        lon: Number(coord2),
        days: 8,
      }).then(result => {
        console.log(result.data)
        const forecasts = result.data;
        if (forecasts && forecasts.length > 0) {
            $("#weather-forecast-container").empty(); // ê¸°ì¡´ ì¹´ë“œ ë¹„ìš°ê¸°
            forecasts.forEach((day, index) => {
                const dateParts = day.date.split('-');
                const month = parseInt(dateParts[1], 10);
                const dayOfMonth = parseInt(dateParts[2], 10);
                const displayDate = `${month}/${dayOfMonth}`;

                const temp = Math.round(day.maxTemp);
                const emoji = weatherTypeToEmoji(day.daytime.type);

                const cardHtml = `
                    <div class="weather-day-card" id="weather-day-${index}">
                        <div class="weather-day-date">${displayDate}</div>
                        <div class="weather-day-icon">${emoji}</div>
                        <div class="weather-day-temp">${temp}Â°</div>
                    </div>
                `;
                $("#weather-forecast-container").append(cardHtml);
            });
        }
      }).catch(error => {
        console.error("ë‚ ì”¨ ì •ë³´ ë¡œë”© ì—ëŸ¬!", error);
        $('#weather-forecast-section').hide();
      });

      // // ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
      // // The Firebase SDK is initialized and available here!
      //
      // firebase.auth().onAuthStateChanged(user => { });
      // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
      // firebase.firestore().doc('/foo/bar').get().then(() => { });
      // firebase.functions().httpsCallable('yourFunction')().then(() => { });
      // firebase.messaging().requestPermission().then(() => { });
      // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });

      firebase.functions().httpsCallable('getLatestExchangeRate')().then((result) => {
        console.log(result.data)
        for(let item of result.data) {

            if(item.id.indexOf("ë¯¸êµ­ë‹¬ëŸ¬") != -1 && nationname.match("ë¯¸êµ­")) {
                $("#exchangerate").text(item.id + " " + item.value)
                break
            }
            if(item.id.indexOf("ìœ„ì•ˆ") != -1 && nationname.match("ì¤‘êµ­")) {
                $("#exchangerate").text(item.id + " " + item.value)
                break
            }
            if(item.id.indexOf(nationname) != -1) {
                $("#exchangerate").text(item.id + " " + item.value)
                break
            }
        }
      }).catch((error) => {
          console.log("í™˜ìœ¨ ERROR!", error);
      });
    
    //   firebase.analytics().logEvent('tutorial_completed');
      // firebase.performance(); // call to activate
      //
      // // ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.min.js" integrity="sha384-RuyvpeZCxMJCqVUGFI0Do1mQrods/hhxYlcVfGPOfQtPJh0JCw12tUAZ/Mv10S7D" crossorigin="anonymous"></script> -->
</body>

</html>
